<!DOCTYPE html>
<html>
    <head>
        <title>Barvičky</title>
    </head>
    <body>
        <form>
            <input type="file" name="file" accept="image/*"/>
            <button type="submit">Rozložit</button>
        </form>
        <p>
            <canvas id="image_r"></canvas>
            <canvas id="image_g"></canvas>
            <canvas id="image_b"></canvas>
        </p>
        <script>
            class Pixel {
                #r;
                #g;
                #b;

                constructor(r, g, b) {
                    this.#r = r;
                    this.#g = g;
                    this.#b = b;
                }

                r() {
                    return this.#r;
                }

                g() {
                    return this.#g;
                }

                b() {
                    return this.#b;
                }

                filterRed(threshold) {
                    return Pixel.#filter(this.#r, threshold, RED);
                }

                filterGreen(threshold) {
                    return Pixel.#filter(this.#g, threshold, GREEN);
                }

                filterBlue(threshold) {
                    return Pixel.#filter(this.#b, threshold, BLUE);
                }

                static #filter(value, threshold, color) {
                    if (value >= threshold) {
                        return color;
                    } else {
                        return WHITE;
                    }
                }
            }

            const RED = new Pixel(255, 0, 0);
            const GREEN = new Pixel(0, 255, 0);
            const BLUE = new Pixel(0, 0, 255);
            const WHITE = new Pixel(255, 255, 255);

            function populateCanvas(canvasElement, image, transformation) {
                const context = canvasElement.getContext('2d');
                const canvas = context.canvas;
                const width = image.width;
                const height = image.height;
                canvas.width = width;
                canvas.height = height;
                context.drawImage(image, 0, 0, width, height);
                const imageData = context.getImageData(0, 0, width, height);
                const rawImageData = imageData.data;
                for (let i = 0; i < rawImageData.length; i += 4) {
                    const transformed = transformation(new Pixel(rawImageData[i], rawImageData[i + 1], rawImageData[i + 2]));
                    rawImageData[i] = transformed.r();
                    rawImageData[i + 1] = transformed.g();
                    rawImageData[i + 2] = transformed.b();
                }
                context.putImageData(imageData, 0, 0);
            }

            function repaint(file) {
                const image = new Image();
                image.onload = function () {
                    populateCanvas(document.getElementById('image_r'), this, function(pixel) { return pixel.filterRed(128) });
                    populateCanvas(document.getElementById('image_g'), this, function(pixel) { return pixel.filterGreen(128) });
                    populateCanvas(document.getElementById('image_b'), this, function(pixel) { return pixel.filterBlue(128) });
                };
                const reader = new FileReader();
                reader.onload = function (e) {
                    image.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }

            document.querySelector('form').addEventListener('submit', function (e) {
                e.preventDefault();
                repaint(new FormData(this).get('file'));
            });
            document.querySelector("input[type='file']").addEventListener('change', function() {
                repaint(this.files[0]);
            });
        </script>
    </body>
</html>